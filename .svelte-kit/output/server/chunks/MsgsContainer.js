import { c as create_ssr_component, a as subscribe, f as escape, e as each, d as add_attribute, n as null_to_empty } from "./ssr.js";
import { p as page } from "./stores.js";
import { g as getProfilePicture, G as GetUsername, f as formatDate } from "./users.js";
const css$1 = {
  code: ".msg-input.svelte-3nwjbm textarea.svelte-3nwjbm{resize:none;width:50rem;min-height:29px;height:fit-content;font-size:15px;font-family:inherit;border-radius:25px;padding:10px}.container.dark .msg-input.svelte-3nwjbm textarea.svelte-3nwjbm{color:#fff;background:#303030;border:2px solid #fff}.msg-input.svelte-3nwjbm.svelte-3nwjbm{display:flex;align-items:center;justify-content:center;gap:20px;margin-top:auto;position:relative;bottom:0}.msg-input.svelte-3nwjbm button.svelte-3nwjbm{background:#ffffff;border:#005fcf solid 2px;cursor:pointer;border-radius:25px;width:97px;height:49px;color:#005fcf;font-size:15px;transition:background 0.5s,\r\n		color 0.5s}.msg-input.svelte-3nwjbm button.svelte-3nwjbm:focus,.msg-input.svelte-3nwjbm button.svelte-3nwjbm:hover{background:#005fcf;border-color:#fff;color:#fff}.container.dark .msg-input.svelte-3nwjbm button.svelte-3nwjbm{background:#151ca9;color:#fff;border:none}.container.dark .msg-input.svelte-3nwjbm button.svelte-3nwjbm:focus,.container.dark .msg-input.svelte-3nwjbm button.svelte-3nwjbm:hover{background:#fff;color:#151ca9;border:none}",
  map: `{"version":3,"file":"MsgInput.svelte","sources":["MsgInput.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { page } from \\"$app/stores\\";\\nexport let id = \\"\\";\\nlet msg = \\"\\";\\nexport let socket;\\nlet showBtn = false;\\n<\/script>\\r\\n\\r\\n<div class=\\"msg-input\\">\\r\\n\\t<textarea bind:value={msg} />\\r\\n\\t<button\\r\\n\\t\\ttype=\\"button\\"\\r\\n\\t\\ton:click={() => {\\r\\n\\t\\t\\tif (!msg.length) return;\\r\\n\\t\\t\\tconst data = JSON.stringify({\\r\\n\\t\\t\\t\\ttext: msg,\\r\\n\\t\\t\\t\\ttoid: parseInt(id),\\r\\n\\t\\t\\t\\ttype: $page.route.id?.includes('/direct') ? 'direct' : 'broadcast'\\r\\n\\t\\t\\t});\\r\\n\\t\\t\\tsocket.send(data);\\r\\n\\r\\n\\t\\t\\tmsg = '';\\r\\n\\t\\t}}>Send</button\\r\\n\\t>\\r\\n</div>\\r\\n\\r\\n<style>.msg-input textarea {\\r\\n\\tresize: none;\\r\\n\\twidth: 50rem;\\r\\n\\tmin-height: 29px;\\r\\n\\theight: fit-content;\\r\\n\\tfont-size: 15px;\\r\\n\\tfont-family: inherit;\\r\\n\\tborder-radius: 25px;\\r\\n\\tpadding: 10px;\\r\\n}\\r\\n\\r\\n.container.dark .msg-input textarea {\\r\\n\\tcolor: #fff;\\r\\n\\tbackground: #303030;\\r\\n\\tborder: 2px solid #fff;\\r\\n}\\r\\n\\r\\n.msg-input {\\r\\n\\tdisplay: flex;\\r\\n\\talign-items: center;\\r\\n\\tjustify-content: center;\\r\\n\\tgap: 20px;\\r\\n\\tmargin-top: auto;\\r\\n\\tposition: relative;\\r\\n\\tbottom: 0;\\r\\n}\\r\\n\\r\\n.msg-input button {\\r\\n\\tbackground: #ffffff;\\r\\n\\tborder: #005fcf solid 2px;\\r\\n\\tcursor: pointer;\\r\\n\\tborder-radius: 25px;\\r\\n\\twidth: 97px;\\r\\n\\theight: 49px;\\r\\n\\tcolor: #005fcf;\\r\\n\\tfont-size: 15px;\\r\\n\\ttransition:\\r\\n\\t\\tbackground 0.5s,\\r\\n\\t\\tcolor 0.5s;\\r\\n}\\r\\n\\r\\n.msg-input button:focus,\\r\\n.msg-input button:hover {\\r\\n\\tbackground: #005fcf;\\r\\n\\tborder-color: #fff;\\r\\n\\tcolor: #fff;\\r\\n}\\r\\n\\r\\n.container.dark .msg-input button {\\r\\n\\tbackground: #151ca9;\\r\\n\\tcolor: #fff;\\r\\n\\tborder: none;\\r\\n}\\r\\n\\r\\n.container.dark .msg-input button:focus,\\r\\n.container.dark .msg-input button:hover {\\r\\n\\tbackground: #fff;\\r\\n\\tcolor: #151ca9;\\r\\n\\tborder: none;\\r\\n}\\r\\n</style>\\r\\n"],"names":[],"mappings":"AAyBO,wBAAU,CAAC,sBAAS,CAC1B,MAAM,CAAE,IAAI,CACZ,KAAK,CAAE,KAAK,CACZ,UAAU,CAAE,IAAI,CAChB,MAAM,CAAE,WAAW,CACnB,SAAS,CAAE,IAAI,CACf,WAAW,CAAE,OAAO,CACpB,aAAa,CAAE,IAAI,CACnB,OAAO,CAAE,IACV,CAEA,UAAU,KAAK,CAAC,wBAAU,CAAC,sBAAS,CACnC,KAAK,CAAE,IAAI,CACX,UAAU,CAAE,OAAO,CACnB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IACnB,CAEA,sCAAW,CACV,OAAO,CAAE,IAAI,CACb,WAAW,CAAE,MAAM,CACnB,eAAe,CAAE,MAAM,CACvB,GAAG,CAAE,IAAI,CACT,UAAU,CAAE,IAAI,CAChB,QAAQ,CAAE,QAAQ,CAClB,MAAM,CAAE,CACT,CAEA,wBAAU,CAAC,oBAAO,CACjB,UAAU,CAAE,OAAO,CACnB,MAAM,CAAE,OAAO,CAAC,KAAK,CAAC,GAAG,CACzB,MAAM,CAAE,OAAO,CACf,aAAa,CAAE,IAAI,CACnB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,KAAK,CAAE,OAAO,CACd,SAAS,CAAE,IAAI,CACf,UAAU,CACT,UAAU,CAAC,IAAI,CAAC;AAClB,EAAE,KAAK,CAAC,IACR,CAEA,wBAAU,CAAC,oBAAM,MAAM,CACvB,wBAAU,CAAC,oBAAM,MAAO,CACvB,UAAU,CAAE,OAAO,CACnB,YAAY,CAAE,IAAI,CAClB,KAAK,CAAE,IACR,CAEA,UAAU,KAAK,CAAC,wBAAU,CAAC,oBAAO,CACjC,UAAU,CAAE,OAAO,CACnB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IACT,CAEA,UAAU,KAAK,CAAC,wBAAU,CAAC,oBAAM,MAAM,CACvC,UAAU,KAAK,CAAC,wBAAU,CAAC,oBAAM,MAAO,CACvC,UAAU,CAAE,IAAI,CAChB,KAAK,CAAE,OAAO,CACd,MAAM,CAAE,IACT"}`
};
const MsgInput = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $$unsubscribe_page;
  $$unsubscribe_page = subscribe(page, (value) => value);
  let { id = "" } = $$props;
  let { socket } = $$props;
  if ($$props.id === void 0 && $$bindings.id && id !== void 0)
    $$bindings.id(id);
  if ($$props.socket === void 0 && $$bindings.socket && socket !== void 0)
    $$bindings.socket(socket);
  $$result.css.add(css$1);
  $$unsubscribe_page();
  return `<div class="msg-input svelte-3nwjbm"><textarea class="svelte-3nwjbm">${escape("")}</textarea> <button type="button" class="svelte-3nwjbm" data-svelte-h="svelte-1akjop2">Send</button> </div>`;
});
const css = {
  code: ".msg-content.svelte-dbghat.svelte-dbghat{width:fit-content;max-width:45rem;min-width:250px;height:fit-content;padding:12px 14px;border-radius:20px;word-wrap:break-word;color:#000;box-shadow:1px 3px 3px 4px rgba(0, 0, 0, 0.25);background:#fff;display:flex;flex-direction:column;justify-content:center;gap:6px;position:relative}.msg-container.svelte-dbghat.svelte-dbghat::-webkit-scrollbar{max-width:2rem}.msg-content.svelte-dbghat div.svelte-dbghat{font-size:18px}.msg-content.svelte-dbghat span.svelte-dbghat{display:flex;justify-content:flex-end;color:#c5c5c5;font-size:9px;position:absolute;right:14px;bottom:4px}.msg-content.svelte-dbghat span.svelte-dbghat:nth-child(1){position:relative;color:#7a7a7a;font-weight:700;font-size:0.75rem;left:0;justify-content:flex-start;width:fit-content;height:fit-content}.shortened.svelte-dbghat.svelte-dbghat::after{content:'...'}.show-more.svelte-dbghat.svelte-dbghat{background:transparent;cursor:pointer;color:#c1dafd;border:none}.show-more.svelte-dbghat.svelte-dbghat:hover{text-decoration:underline}.msg-content.svelte-dbghat span a.svelte-dbghat{color:inherit;text-decoration:none}.msg-container.svelte-dbghat.svelte-dbghat{display:flex;flex-direction:column;gap:1rem;width:100%;overflow-y:scroll}.msg-container.svelte-dbghat>div.svelte-dbghat{display:flex;align-items:start;gap:14px}.sent-by-me.svelte-dbghat.svelte-dbghat{background:#479cff;color:#fff;border:none;margin-left:auto}.date-display.svelte-dbghat.svelte-dbghat{margin-left:auto;margin-right:auto;color:#ffffff;background:#377206;padding:4px 6px;border-radius:25px}.msg-profile-picture.svelte-dbghat.svelte-dbghat{width:50px;height:50px;border-radius:50%}",
  map: `{"version":3,"file":"MsgsContainer.svelte","sources":["MsgsContainer.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { page } from \\"$app/stores\\";\\nimport { GetUsername, formatDate, getProfilePicture } from \\"$lib/users.ts\\";\\nimport { onMount } from \\"svelte\\";\\nexport let messages = [];\\nlet dates = /* @__PURE__ */ new Map();\\nexport let currentRoomMembers = [];\\nfunction computeDateDivider(msg, i) {\\n  const formattedDate = formatDate(String(msg.sentat));\\n  if (![...dates.values()].includes(String(formattedDate.ofYear))) {\\n    dates.set(i, String(formattedDate.ofYear));\\n  }\\n  msg.shortened = msg.text.length > 1400;\\n  return msg;\\n}\\n$:\\n  messages = messages.map(computeDateDivider);\\n<\/script>\\r\\n\\r\\n<div class=\\"msg-container\\">\\r\\n\\t{#each messages as message, index (message.id)}\\r\\n\\t\\t{#if dates.get(index)}\\r\\n\\t\\t\\t<div class=\\"date-display\\">\\r\\n\\t\\t\\t\\t{dates.get(index)}\\r\\n\\t\\t\\t</div>\\r\\n\\t\\t{/if}\\r\\n\\t\\t<div>\\r\\n\\t\\t\\t{#if message.from != $page.data.USER.id}\\r\\n\\t\\t\\t\\t<img\\r\\n\\t\\t\\t\\t\\tclass=\\"msg-profile-picture\\"\\r\\n\\t\\t\\t\\t\\talt=\\"pfp\\"\\r\\n\\t\\t\\t\\t\\tsrc={getProfilePicture(message.from, currentRoomMembers)}\\r\\n\\t\\t\\t\\t/>\\r\\n\\t\\t\\t{/if}\\r\\n\\t\\t\\t<div class=\\"msg-content\\" class:sent-by-me={$page.data.USER.id === message.from}>\\r\\n\\t\\t\\t\\t{#if message.from !== $page.data.USER.id}\\r\\n\\t\\t\\t\\t\\t<span\\r\\n\\t\\t\\t\\t\\t\\t><a href=\\"/profiles/{message.from}\\">{GetUsername(message.from, currentRoomMembers)}</a\\r\\n\\t\\t\\t\\t\\t\\t></span\\r\\n\\t\\t\\t\\t\\t>\\r\\n\\t\\t\\t\\t{/if}\\r\\n\\t\\t\\t\\t<div class={message.shortened ? 'shortened' : ''}>\\r\\n\\t\\t\\t\\t\\t{message.shortened ? message.text.split('').slice(0, 1400).join('') : message.text}\\r\\n\\t\\t\\t\\t\\t{#if message.shortened}\\r\\n\\t\\t\\t\\t\\t\\t<button type=\\"button\\" class=\\"show-more\\" on:click={() => (message.shortened = false)}\\r\\n\\t\\t\\t\\t\\t\\t\\t>Show more</button\\r\\n\\t\\t\\t\\t\\t\\t>\\r\\n\\t\\t\\t\\t\\t{/if}\\r\\n\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t<span>{formatDate(String(message.sentat)).ofDay}</span>\\r\\n\\t\\t\\t</div>\\r\\n\\t\\t</div>\\r\\n\\t{/each}\\r\\n</div>\\r\\n\\r\\n<style>.msg-content {\\r\\n\\twidth: fit-content;\\r\\n\\tmax-width: 45rem;\\r\\n\\tmin-width: 250px;\\r\\n\\theight: fit-content;\\r\\n\\tpadding: 12px 14px;\\r\\n\\tborder-radius: 20px;\\r\\n\\tword-wrap: break-word;\\r\\n\\tcolor: #000;\\r\\n\\tbox-shadow: 1px 3px 3px 4px rgba(0, 0, 0, 0.25);\\r\\n\\tbackground: #fff;\\r\\n\\tdisplay: flex;\\r\\n\\tflex-direction: column;\\r\\n\\tjustify-content: center;\\r\\n\\tgap: 6px;\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.msg-container::-webkit-scrollbar {\\r\\n\\tmax-width: 2rem;\\r\\n}\\r\\n\\r\\n.msg-content div {\\r\\n\\tfont-size: 18px;\\r\\n}\\r\\n\\r\\n.msg-content span {\\r\\n\\tdisplay: flex;\\r\\n\\tjustify-content: flex-end;\\r\\n\\tcolor: #c5c5c5;\\r\\n\\tfont-size: 9px;\\r\\n\\tposition: absolute;\\r\\n\\tright: 14px;\\r\\n\\tbottom: 4px;\\r\\n}\\r\\n\\r\\n.msg-content span:nth-child(1) {\\r\\n\\tposition: relative;\\r\\n\\tcolor: #7a7a7a;\\r\\n\\tfont-weight: 700;\\r\\n\\tfont-size: 0.75rem;\\r\\n\\tleft: 0;\\r\\n\\tjustify-content: flex-start;\\r\\n\\twidth: fit-content;\\r\\n\\theight: fit-content;\\r\\n}\\r\\n\\r\\n.shortened::after {\\r\\n\\tcontent: '...';\\r\\n}\\r\\n\\r\\n.show-more {\\r\\n\\tbackground: transparent;\\r\\n\\tcursor: pointer;\\r\\n\\tcolor: #c1dafd;\\r\\n\\tborder: none;\\r\\n}\\r\\n\\r\\n.show-more:hover {\\r\\n\\ttext-decoration: underline;\\r\\n}\\r\\n\\r\\n.msg-content span a {\\r\\n\\tcolor: inherit;\\r\\n\\ttext-decoration: none;\\r\\n}\\r\\n\\r\\n.msg-container {\\r\\n\\tdisplay: flex;\\r\\n\\tflex-direction: column;\\r\\n\\tgap: 1rem;\\r\\n\\twidth: 100%;\\r\\n\\toverflow-y: scroll;\\r\\n}\\r\\n\\r\\n.msg-container > div {\\r\\n\\tdisplay: flex;\\r\\n\\talign-items: start;\\r\\n\\tgap: 14px;\\r\\n}\\r\\n\\r\\n.sent-by-me {\\r\\n\\tbackground: #479cff;\\r\\n\\tcolor: #fff;\\r\\n\\tborder: none;\\r\\n\\tmargin-left: auto;\\r\\n}\\r\\n\\r\\n.date-display {\\r\\n\\tmargin-left: auto;\\r\\n\\tmargin-right: auto;\\r\\n\\tcolor: #ffffff;\\r\\n\\tbackground: #377206;\\r\\n\\tpadding: 4px 6px;\\r\\n\\tborder-radius: 25px;\\r\\n}\\r\\n\\r\\n.msg-profile-picture {\\r\\n\\twidth: 50px;\\r\\n\\theight: 50px;\\r\\n\\tborder-radius: 50%;\\r\\n}\\r\\n</style>\\r\\n"],"names":[],"mappings":"AAsDO,wCAAa,CACnB,KAAK,CAAE,WAAW,CAClB,SAAS,CAAE,KAAK,CAChB,SAAS,CAAE,KAAK,CAChB,MAAM,CAAE,WAAW,CACnB,OAAO,CAAE,IAAI,CAAC,IAAI,CAClB,aAAa,CAAE,IAAI,CACnB,SAAS,CAAE,UAAU,CACrB,KAAK,CAAE,IAAI,CACX,UAAU,CAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAC/C,UAAU,CAAE,IAAI,CAChB,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,eAAe,CAAE,MAAM,CACvB,GAAG,CAAE,GAAG,CACR,QAAQ,CAAE,QACX,CAEA,0CAAc,mBAAoB,CACjC,SAAS,CAAE,IACZ,CAEA,0BAAY,CAAC,iBAAI,CAChB,SAAS,CAAE,IACZ,CAEA,0BAAY,CAAC,kBAAK,CACjB,OAAO,CAAE,IAAI,CACb,eAAe,CAAE,QAAQ,CACzB,KAAK,CAAE,OAAO,CACd,SAAS,CAAE,GAAG,CACd,QAAQ,CAAE,QAAQ,CAClB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,GACT,CAEA,0BAAY,CAAC,kBAAI,WAAW,CAAC,CAAE,CAC9B,QAAQ,CAAE,QAAQ,CAClB,KAAK,CAAE,OAAO,CACd,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,OAAO,CAClB,IAAI,CAAE,CAAC,CACP,eAAe,CAAE,UAAU,CAC3B,KAAK,CAAE,WAAW,CAClB,MAAM,CAAE,WACT,CAEA,sCAAU,OAAQ,CACjB,OAAO,CAAE,KACV,CAEA,sCAAW,CACV,UAAU,CAAE,WAAW,CACvB,MAAM,CAAE,OAAO,CACf,KAAK,CAAE,OAAO,CACd,MAAM,CAAE,IACT,CAEA,sCAAU,MAAO,CAChB,eAAe,CAAE,SAClB,CAEA,0BAAY,CAAC,IAAI,CAAC,eAAE,CACnB,KAAK,CAAE,OAAO,CACd,eAAe,CAAE,IAClB,CAEA,0CAAe,CACd,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,GAAG,CAAE,IAAI,CACT,KAAK,CAAE,IAAI,CACX,UAAU,CAAE,MACb,CAEA,4BAAc,CAAG,iBAAI,CACpB,OAAO,CAAE,IAAI,CACb,WAAW,CAAE,KAAK,CAClB,GAAG,CAAE,IACN,CAEA,uCAAY,CACX,UAAU,CAAE,OAAO,CACnB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,WAAW,CAAE,IACd,CAEA,yCAAc,CACb,WAAW,CAAE,IAAI,CACjB,YAAY,CAAE,IAAI,CAClB,KAAK,CAAE,OAAO,CACd,UAAU,CAAE,OAAO,CACnB,OAAO,CAAE,GAAG,CAAC,GAAG,CAChB,aAAa,CAAE,IAChB,CAEA,gDAAqB,CACpB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,aAAa,CAAE,GAChB"}`
};
const MsgsContainer = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $page, $$unsubscribe_page;
  $$unsubscribe_page = subscribe(page, (value) => $page = value);
  let { messages = [] } = $$props;
  let dates = /* @__PURE__ */ new Map();
  let { currentRoomMembers = [] } = $$props;
  function computeDateDivider(msg, i) {
    const formattedDate = formatDate(String(msg.sentat));
    if (![...dates.values()].includes(String(formattedDate.ofYear))) {
      dates.set(i, String(formattedDate.ofYear));
    }
    msg.shortened = msg.text.length > 1400;
    return msg;
  }
  if ($$props.messages === void 0 && $$bindings.messages && messages !== void 0)
    $$bindings.messages(messages);
  if ($$props.currentRoomMembers === void 0 && $$bindings.currentRoomMembers && currentRoomMembers !== void 0)
    $$bindings.currentRoomMembers(currentRoomMembers);
  $$result.css.add(css);
  messages = messages.map(computeDateDivider);
  $$unsubscribe_page();
  return `<div class="msg-container svelte-dbghat">${each(messages, (message, index) => {
    return `${dates.get(index) ? `<div class="date-display svelte-dbghat">${escape(dates.get(index))} </div>` : ``} <div class="svelte-dbghat">${message.from != $page.data.USER.id ? `<img class="msg-profile-picture svelte-dbghat" alt="pfp"${add_attribute("src", getProfilePicture(message.from, currentRoomMembers), 0)}>` : ``} <div class="${[
      "msg-content svelte-dbghat",
      $page.data.USER.id === message.from ? "sent-by-me" : ""
    ].join(" ").trim()}">${message.from !== $page.data.USER.id ? `<span class="svelte-dbghat"><a href="${"/profiles/" + escape(message.from, true)}" class="svelte-dbghat">${escape(GetUsername(message.from, currentRoomMembers))}</a></span>` : ``} <div class="${escape(null_to_empty(message.shortened ? "shortened" : ""), true) + " svelte-dbghat"}">${escape(message.shortened ? message.text.split("").slice(0, 1400).join("") : message.text)} ${message.shortened ? `<button type="button" class="show-more svelte-dbghat" data-svelte-h="svelte-1vnbx2g">Show more</button>` : ``}</div> <span class="svelte-dbghat">${escape(formatDate(String(message.sentat)).ofDay)}</span></div> </div>`;
  })} </div>`;
});
export {
  MsgsContainer as M,
  MsgInput as a
};
