import{s as le,e as b,a as D,c as k,b as S,f as c,g as M,l as ae,m as d,i as w,h as g,u as X,o as B,n as A,r as fe,k as ie,C as z,t as N,d as V,$ as F,y as H,j as P,A as K}from"./scheduler.DCHIdItQ.js";import{S as ne,i as re}from"./index.BPubO7i7.js";import{p as oe}from"./stores.DUnNtWjl.js";import{e as L,u as de,d as ue}from"./each.Btz5aSee.js";import{f as Y,a as Q,G as W}from"./users.Dl7qTyP5.js";const ce=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function he(o){let e,t,a,l,n="Send",s,i;return{c(){e=b("div"),t=b("textarea"),a=D(),l=b("button"),l.textContent=n,this.h()},l(f){e=k(f,"DIV",{class:!0});var r=S(e);t=k(r,"TEXTAREA",{class:!0}),S(t).forEach(c),a=M(r),l=k(r,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),ae(l)!=="svelte-1akjop2"&&(l.textContent=n),r.forEach(c),this.h()},h(){d(t,"class","svelte-3nwjbm"),d(l,"type","button"),d(l,"class","svelte-3nwjbm"),d(e,"class","msg-input svelte-3nwjbm")},m(f,r){w(f,e,r),g(e,t),X(t,o[2]),g(e,a),g(e,l),s||(i=[B(t,"input",o[4]),B(l,"click",o[5])],s=!0)},p(f,[r]){r&4&&X(t,f[2])},i:A,o:A,d(f){f&&c(e),s=!1,fe(i)}}}function me(o,e,t){let a;ie(o,oe,r=>t(3,a=r));let{id:l=""}=e,n="",{socket:s}=e;function i(){n=this.value,t(2,n)}const f=()=>{var E;if(!n.length)return;const r=JSON.stringify({text:n,toid:parseInt(l),type:(E=a.route.id)!=null&&E.includes("/direct")?"direct":"broadcast"});s.send(r),t(2,n="")};return o.$$set=r=>{"id"in r&&t(0,l=r.id),"socket"in r&&t(1,s=r.socket)},[l,s,n,a,i,f]}class ye extends ne{constructor(e){super(),re(this,e,me,he,le,{id:0,socket:1})}}const{Map:_e}=ce;function Z(o,e,t){const a=o.slice();return a[6]=e[t],a[7]=e,a[8]=t,a}function $(o){let e,t=o[3].get(o[8])+"",a;return{c(){e=b("div"),a=N(t),this.h()},l(l){e=k(l,"DIV",{class:!0});var n=S(e);a=V(n,t),n.forEach(c),this.h()},h(){d(e,"class","date-display svelte-dbghat")},m(l,n){w(l,e,n),g(e,a)},p(l,n){n&1&&t!==(t=l[3].get(l[8])+"")&&P(a,t)},d(l){l&&c(e)}}}function x(o){let e,t;return{c(){e=b("img"),this.h()},l(a){e=k(a,"IMG",{class:!0,alt:!0,src:!0}),this.h()},h(){d(e,"class","msg-profile-picture svelte-dbghat"),d(e,"alt","pfp"),K(e.src,t=Q(o[6].from,o[1]))||d(e,"src",t)},m(a,l){w(a,e,l)},p(a,l){l&3&&!K(e.src,t=Q(a[6].from,a[1]))&&d(e,"src",t)},d(a){a&&c(e)}}}function ee(o){let e,t,a=W(o[6].from,o[1])+"",l,n;return{c(){e=b("span"),t=b("a"),l=N(a),this.h()},l(s){e=k(s,"SPAN",{class:!0});var i=S(e);t=k(i,"A",{href:!0,class:!0});var f=S(t);l=V(f,a),f.forEach(c),i.forEach(c),this.h()},h(){d(t,"href",n="/profiles/"+o[6].from),d(t,"class","svelte-dbghat"),d(e,"class","svelte-dbghat")},m(s,i){w(s,e,i),g(e,t),g(t,l)},p(s,i){i&3&&a!==(a=W(s[6].from,s[1])+"")&&P(l,a),i&1&&n!==(n="/profiles/"+s[6].from)&&d(t,"href",n)},d(s){s&&c(e)}}}function te(o){let e,t="Show more",a,l;function n(){return o[4](o[6],o[7],o[8])}return{c(){e=b("button"),e.textContent=t,this.h()},l(s){e=k(s,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-1vnbx2g"&&(e.textContent=t),this.h()},h(){d(e,"type","button"),d(e,"class","show-more svelte-dbghat")},m(s,i){w(s,e,i),a||(l=B(e,"click",n),a=!0)},p(s,i){o=s},d(s){s&&c(e),a=!1,l()}}}function se(o,e){let t,a=e[3].get(e[8]),l,n,s,i,f,r,E=(e[6].shortened?e[6].text.split("").slice(0,1400).join(""):e[6].text)+"",y,G,U,O,R,I=Y(String(e[6].sentat)).ofDay+"",T,q,h=a&&$(e),m=e[6].from!=e[2].data.USER.id&&x(e),_=e[6].from!==e[2].data.USER.id&&ee(e),p=e[6].shortened&&te(e);return{key:o,first:null,c(){t=z(),h&&h.c(),l=D(),n=b("div"),m&&m.c(),s=D(),i=b("div"),_&&_.c(),f=D(),r=b("div"),y=N(E),G=D(),p&&p.c(),O=D(),R=b("span"),T=N(I),q=D(),this.h()},l(v){t=z(),h&&h.l(v),l=M(v),n=k(v,"DIV",{class:!0});var u=S(n);m&&m.l(u),s=M(u),i=k(u,"DIV",{class:!0});var C=S(i);_&&_.l(C),f=M(C),r=k(C,"DIV",{class:!0});var j=S(r);y=V(j,E),G=M(j),p&&p.l(j),j.forEach(c),O=M(C),R=k(C,"SPAN",{class:!0});var J=S(R);T=V(J,I),J.forEach(c),C.forEach(c),q=M(u),u.forEach(c),this.h()},h(){d(r,"class",U=F(e[6].shortened?"shortened":"")+" svelte-dbghat"),d(R,"class","svelte-dbghat"),d(i,"class","msg-content svelte-dbghat"),H(i,"sent-by-me",e[2].data.USER.id===e[6].from),d(n,"class","svelte-dbghat"),this.first=t},m(v,u){w(v,t,u),h&&h.m(v,u),w(v,l,u),w(v,n,u),m&&m.m(n,null),g(n,s),g(n,i),_&&_.m(i,null),g(i,f),g(i,r),g(r,y),g(r,G),p&&p.m(r,null),g(i,O),g(i,R),g(R,T),g(n,q)},p(v,u){e=v,u&1&&(a=e[3].get(e[8])),a?h?h.p(e,u):(h=$(e),h.c(),h.m(l.parentNode,l)):h&&(h.d(1),h=null),e[6].from!=e[2].data.USER.id?m?m.p(e,u):(m=x(e),m.c(),m.m(n,s)):m&&(m.d(1),m=null),e[6].from!==e[2].data.USER.id?_?_.p(e,u):(_=ee(e),_.c(),_.m(i,f)):_&&(_.d(1),_=null),u&1&&E!==(E=(e[6].shortened?e[6].text.split("").slice(0,1400).join(""):e[6].text)+"")&&P(y,E),e[6].shortened?p?p.p(e,u):(p=te(e),p.c(),p.m(r,null)):p&&(p.d(1),p=null),u&1&&U!==(U=F(e[6].shortened?"shortened":"")+" svelte-dbghat")&&d(r,"class",U),u&1&&I!==(I=Y(String(e[6].sentat)).ofDay+"")&&P(T,I),u&5&&H(i,"sent-by-me",e[2].data.USER.id===e[6].from)},d(v){v&&(c(t),c(l),c(n)),h&&h.d(v),m&&m.d(),_&&_.d(),p&&p.d()}}}function pe(o){let e,t=[],a=new _e,l=L(o[0]);const n=s=>s[6].id;for(let s=0;s<l.length;s+=1){let i=Z(o,l,s),f=n(i);a.set(f,t[s]=se(f,i))}return{c(){e=b("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=k(s,"DIV",{class:!0});var i=S(e);for(let f=0;f<t.length;f+=1)t[f].l(i);i.forEach(c),this.h()},h(){d(e,"class","msg-container svelte-dbghat")},m(s,i){w(s,e,i);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null)},p(s,[i]){i&15&&(l=L(s[0]),t=de(t,i,n,1,s,l,a,e,ue,se,null,Z))},i:A,o:A,d(s){s&&c(e);for(let i=0;i<t.length;i+=1)t[i].d()}}}function ge(o,e,t){let a;ie(o,oe,r=>t(2,a=r));let{messages:l=[]}=e,n=new Map,{currentRoomMembers:s=[]}=e;function i(r,E){const y=Y(String(r.sentat));return[...n.values()].includes(String(y.ofYear))||n.set(E,String(y.ofYear)),r.shortened=r.text.length>1400,r}const f=(r,E,y)=>t(0,E[y].shortened=!1,l);return o.$$set=r=>{"messages"in r&&t(0,l=r.messages),"currentRoomMembers"in r&&t(1,s=r.currentRoomMembers)},o.$$.update=()=>{o.$$.dirty&1&&t(0,l=l.map(i))},[l,s,a,n,f]}class we extends ne{constructor(e){super(),re(this,e,ge,pe,le,{messages:0,currentRoomMembers:1})}}export{ye as M,we as a};
